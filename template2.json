{
    "arm_template": "ARMTemplate: {\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"location\":{\"type\":\"string\"},\"networkInterfaceName1\":{\"type\":\"string\"},\"enableAcceleratedNetworking\":{\"type\":\"bool\"},\"networkSecurityGroupName\":{\"type\":\"string\"},\"networkSecurityGroupRules\":{\"type\":\"array\"},\"subnetName\":{\"type\":\"string\"},\"virtualNetworkId\":{\"type\":\"string\"},\"publicIpAddressName1\":{\"type\":\"string\"},\"publicIpAddressType\":{\"type\":\"string\"},\"publicIpAddressSku\":{\"type\":\"string\"},\"pipDeleteOption\":{\"type\":\"string\"},\"virtualMachineName\":{\"type\":\"string\"},\"virtualMachineName1\":{\"type\":\"string\"},\"virtualMachineComputerName1\":{\"type\":\"string\"},\"virtualMachineRG\":{\"type\":\"string\"},\"osDiskType\":{\"type\":\"string\"},\"osDiskDeleteOption\":{\"type\":\"string\"},\"virtualMachineSize\":{\"type\":\"string\"},\"nicDeleteOption\":{\"type\":\"string\"},\"hibernationEnabled\":{\"type\":\"bool\"},\"adminUsername\":{\"type\":\"string\"},\"patchMode\":{\"type\":\"string\"},\"rebootSetting\":{\"type\":\"string\"},\"virtualMachine1Zone\":{\"type\":\"string\"},\"autoShutdownStatus\":{\"type\":\"string\"},\"autoShutdownTime\":{\"type\":\"string\"},\"autoShutdownTimeZone\":{\"type\":\"string\"},\"autoShutdownNotificationStatus\":{\"type\":\"string\"},\"autoShutdownNotificationLocale\":{\"type\":\"string\"},\"autoShutdownNotificationEmail\":{\"type\":\"string\"},\"appGatewayName\":{\"type\":\"string\"},\"appGateWayRuleName\":{\"type\":\"string\"},\"appGateWayRulePort\":{\"type\":\"int\"},\"appGateWayRuleProtocol\":{\"type\":\"string\"}},\"variables\":{\"nsgId\":\"[resourceId(resourceGroup().name, 'Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroupName'))]\",\"vnetId\":\"[parameters('virtualNetworkId')]\",\"vnetName\":\"[last(split(variables('vnetId'), '/'))]\",\"subnetRef\":\"[concat(variables('vnetId'), '/subnets/', parameters('subnetName'))]\",\"aadLoginExtensionName\":\"AADSSHLoginForLinux\"},\"resources\":[{\"name\":\"[parameters('networkInterfaceName1')]\",\"type\":\"Microsoft.Network/networkInterfaces\",\"apiVersion\":\"2022-11-01\",\"location\":\"[parameters('location')]\",\"dependsOn\":[\"[concat('Microsoft.Network/networkSecurityGroups/', parameters('networkSecurityGroupName'))]\",\"[concat('Microsoft.Network/publicIpAddresses/', parameters('publicIpAddressName1'))]\",\"[concat('Microsoft.Network/applicationGateways/', parameters('appGatewayName'))]\"],\"properties\":{\"ipConfigurations\":[{\"name\":\"ipconfig1\",\"properties\":{\"subnet\":{\"id\":\"[variables('subnetRef')]\"},\"privateIPAllocationMethod\":\"Dynamic\",\"publicIpAddress\":{\"id\":\"[resourceId(resourceGroup().name, 'Microsoft.Network/publicIpAddresses', parameters('publicIpAddressName1'))]\",\"properties\":{\"deleteOption\":\"[parameters('pipDeleteOption')]\"}},\"applicationGatewayBackendAddressPools\":[{\"id\":\"[resourceId('Microsoft.Network/applicationGateways/backendAddressPools', parameters('appGatewayName'), concat(take(parameters('appGatewayName'), sub(80, length('-backendpool01'))), '-backendpool01'))]\"}]}}],\"enableAcceleratedNetworking\":\"[parameters('enableAcceleratedNetworking')]\",\"networkSecurityGroup\":{\"id\":\"[variables('nsgId')]\"}}},{\"name\":\"[parameters('networkSecurityGroupName')]\",\"type\":\"Microsoft.Network/networkSecurityGroups\",\"apiVersion\":\"2020-05-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"securityRules\":\"[parameters('networkSecurityGroupRules')]\"}},{\"name\":\"[parameters('publicIpAddressName1')]\",\"type\":\"Microsoft.Network/publicIpAddresses\",\"apiVersion\":\"2020-08-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publicIpAllocationMethod\":\"[parameters('publicIpAddressType')]\"},\"sku\":{\"name\":\"[parameters('publicIpAddressSku')]\"},\"zones\":[\"[parameters('virtualMachine1Zone')]\"]},{\"name\":\"[parameters('virtualMachineName1')]\",\"type\":\"Microsoft.Compute/virtualMachines\",\"apiVersion\":\"2024-03-01\",\"location\":\"[parameters('location')]\",\"dependsOn\":[\"[concat('Microsoft.Network/networkInterfaces/', parameters('networkInterfaceName1'))]\"],\"properties\":{\"hardwareProfile\":{\"vmSize\":\"[parameters('virtualMachineSize')]\"},\"storageProfile\":{\"osDisk\":{\"createOption\":\"fromImage\",\"managedDisk\":{\"storageAccountType\":\"[parameters('osDiskType')]\"},\"deleteOption\":\"[parameters('osDiskDeleteOption')]\"},\"imageReference\":{\"publisher\":\"canonical\",\"offer\":\"0001-com-ubuntu-server-focal\",\"sku\":\"20_04-lts-gen2\",\"version\":\"latest\"}},\"networkProfile\":{\"networkInterfaces\":[{\"id\":\"[resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfaceName1'))]\",\"properties\":{\"deleteOption\":\"[parameters('nicDeleteOption')]\"}}]},\"additionalCapabilities\":{\"hibernationEnabled\":false},\"osProfile\":{\"computerName\":\"[parameters('virtualMachineComputerName1')]\",\"adminUsername\":\"[parameters('adminUsername')]\",\"linuxConfiguration\":{\"disablePasswordAuthentication\":true,\"patchSettings\":{\"patchMode\":\"[parameters('patchMode')]\",\"automaticByPlatformSettings\":{\"rebootSetting\":\"[parameters('rebootSetting')]\"}}}},\"diagnosticsProfile\":{\"bootDiagnostics\":{\"enabled\":true}}},\"identity\":{\"type\":\"systemAssigned\"},\"zones\":[\"[parameters('virtualMachine1Zone')]\"]},{\"name\":\"[concat('shutdown-computevm-', parameters('virtualMachineName1'))]\",\"type\":\"Microsoft.DevTestLab/schedules\",\"apiVersion\":\"2018-09-15\",\"location\":\"[parameters('location')]\",\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/', parameters('virtualMachineName1'))]\"],\"properties\":{\"status\":\"[parameters('autoShutdownStatus')]\",\"taskType\":\"ComputeVmShutdownTask\",\"dailyRecurrence\":{\"time\":\"[parameters('autoShutdownTime')]\"},\"timeZoneId\":\"[parameters('autoShutdownTimeZone')]\",\"targetResourceId\":\"[resourceId('Microsoft.Compute/virtualMachines', parameters('virtualMachineName1'))]\",\"notificationSettings\":{\"status\":\"[parameters('autoShutdownNotificationStatus')]\",\"notificationLocale\":\"[parameters('autoShutdownNotificationLocale')]\",\"timeInMinutes\":\"30\",\"emailRecipient\":\"[parameters('autoShutdownNotificationEmail')]\"}}},{\"apiVersion\":\"2017-05-10\",\"type\":\"Microsoft.Resources/deployments\",\"name\":\"[concat(variables('vnetName'), '-', 'puw-appgwsubnet')]\",\"properties\":{\"mode\":\"Incremental\",\"parameters\":{},\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{},\"variables\":{},\"resources\":[{\"name\":\"[concat(variables('vnetName'), '/', 'puw-appgwsubnet')]\",\"type\":\"Microsoft.Network/virtualNetworks/subnets\",\"apiVersion\":\"2023-02-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"addressPrefix\":\"10.3.1.0/24\"}}]}},\"resourceGroup\":\"[split(variables('vnetId'),'/')[4]]\"},{\"name\":\"[concat(parameters('appGatewayName'), '-publicip')]\",\"type\":\"Microsoft.Network/publicIpAddresses\",\"apiVersion\":\"2020-08-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publicIpAllocationMethod\":\"Static\",\"publicIPAddressVersion\":\"IPv4\",\"idleTimeoutInMinutes\":15},\"sku\":{\"name\":\"Standard\"},\"zones\":[\"1\"]},{\"name\":\"[parameters('appGatewayName')]\",\"type\":\"Microsoft.Network/applicationGateways\",\"apiVersion\":\"2023-05-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"sku\":{\"name\":\"Standard_v2\",\"tier\":\"Standard_v2\"},\"gatewayIPConfigurations\":[{\"name\":\"[concat(parameters('appGatewayName'), '-gatewayIpConfig01')]\",\"properties\":{\"subnet\":{\"id\":\"[concat(variables('vnetId'), '/subnets/', 'puw-appgwsubnet')]\"}}}],\"frontendIPConfigurations\":[{\"name\":\"[concat(parameters('appGatewayName'), '-frontendconfig01')]\",\"properties\":{\"publicIPAddress\":{\"id\":\"[resourceId('Microsoft.Network/publicIpAddresses', concat(parameters('appGatewayName'), '-publicip'))]\"}}}],\"frontendPorts\":[{\"name\":\"[concat('port_', parameters('appGateWayRulePort'))]\",\"properties\":{\"port\":\"[parameters('appGateWayRulePort')]\"}}],\"backendAddressPools\":[{\"name\":\"[concat(take(parameters('appGatewayName'), sub(80, length('-backendpool01'))), '-backendpool01')]\"}],\"backendHttpSettingsCollection\":[{\"name\":\"[concat(parameters('appGatewayName'), '-httpSetting01')]\",\"properties\":{\"port\":\"[parameters('appGateWayRulePort')]\",\"protocol\":\"[parameters('appGateWayRuleProtocol')]\",\"requestTimeout\":15}}],\"httpListeners\":[{\"name\":\"[concat(parameters('appGatewayName'), '-httpListener01')]\",\"properties\":{\"frontendIPConfiguration\":{\"id\":\"[resourceId('Microsoft.Network/applicationGateways/frontendIPConfigurations', parameters('appGatewayName'), concat(parameters('appGatewayName'), '-frontendconfig01'))]\"},\"frontendPort\":{\"id\":\"[resourceId('Microsoft.Network/applicationGateways/frontendPorts', parameters('appGatewayName'), concat('port_', parameters('appGateWayRulePort')))]\"},\"protocol\":\"[parameters('appGateWayRuleProtocol')]\"}}],\"requestRoutingRules\":[{\"name\":\"[parameters('appGateWayRuleName')]\",\"properties\":{\"ruleType\":\"Basic\",\"priority\":10010,\"httpListener\":{\"id\":\"[resourceId('Microsoft.Network/applicationGateways/httpListeners', parameters('appGatewayName'), concat(parameters('appGatewayName'), '-httpListener01'))]\"},\"backendAddressPool\":{\"id\":\"[resourceId('Microsoft.Network/applicationGateways/backendAddressPools', parameters('appGatewayName'), concat(take(parameters('appGatewayName'), sub(80, length('-backendpool01'))), '-backendpool01'))]\"},\"backendHttpSettings\":{\"id\":\"[resourceId('Microsoft.Network/applicationGateways/backendHttpSettingsCollection', parameters('appGatewayName'), concat(parameters('appGatewayName'), '-httpSetting01'))]\"}}}],\"enableHttp2\":true,\"autoscaleConfiguration\":{\"minCapacity\":2,\"maxCapacity\":10}},\"dependsOn\":[\"[concat(variables('vnetName'), '-', 'puw-appgwsubnet')]\",\"[resourceId('Microsoft.Network/publicIpAddresses', concat(parameters('appGatewayName'), '-publicip'))]\"]},{\"name\":\"[concat(parameters('virtualMachineName1'),'/', variables('aadLoginExtensionName'))]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"apiVersion\":\"2018-10-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.Azure.ActiveDirectory\",\"type\":\"[variables('aadLoginExtensionName')]\",\"typeHandlerVersion\":\"1.0\",\"autoUpgradeMinorVersion\":true},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/', parameters('virtualMachineName1'))]\"]}],\"outputs\":{\"adminUsername\":{\"type\":\"string\",\"value\":\"[parameters('adminUsername')]\"}}}, TemplateParameters: {\"location\":\"eastus\",\"networkInterfaceName1\":\"vm-2909_z1\",\"enableAcceleratedNetworking\":true,\"networkSecurityGroupName\":\"vm-2-nsg\",\"networkSecurityGroupRules\":[{\"name\":\"default-allow-ssh\",\"properties\":{\"priority\":1000,\"protocol\":\"TCP\",\"access\":\"Allow\",\"direction\":\"Inbound\",\"sourceApplicationSecurityGroups\":[],\"destinationApplicationSecurityGroups\":[],\"sourceAddressPrefix\":\"*\",\"sourcePortRange\":\"*\",\"destinationAddressPrefix\":\"*\",\"destinationPortRange\":\"22\"}},{\"name\":\"test-gateway-allow-inbound\",\"properties\":{\"priority\":999,\"protocol\":\"*\",\"access\":\"Allow\",\"direction\":\"Inbound\",\"sourceApplicationSecurityGroups\":[],\"destinationApplicationSecurityGroups\":[],\"sourceAddressPrefix\":\"*\",\"sourcePortRange\":\"*\",\"destinationAddressPrefix\":\"*\",\"destinationPortRange\":\"80\"}}],\"subnetName\":\"default\",\"virtualNetworkId\":\"/subscriptions/443b0799-279f-401e-a220-aa1463a7710f/resourceGroups/vsk-demo-rg/providers/Microsoft.Network/virtualNetworks/new-vnet\",\"publicIpAddressName1\":\"vm-2-ip\",\"publicIpAddressType\":\"Static\",\"publicIpAddressSku\":\"Standard\",\"pipDeleteOption\":\"Delete\",\"virtualMachineName\":\"vm-2\",\"virtualMachineName1\":\"vm-2\",\"virtualMachineComputerName1\":\"vm-2\",\"virtualMachineRG\":\"vsk-demo-rg\",\"osDiskType\":\"Premium_LRS\",\"osDiskDeleteOption\":\"Delete\",\"virtualMachineSize\":\"Standard_D2lds_v5\",\"nicDeleteOption\":\"Delete\",\"hibernationEnabled\":false,\"adminUsername\":\"azureuser\",\"patchMode\":\"AutomaticByPlatform\",\"rebootSetting\":\"IfRequired\",\"virtualMachine1Zone\":\"1\",\"autoShutdownStatus\":\"Enabled\",\"autoShutdownTime\":\"19:00\",\"autoShutdownTimeZone\":\"UTC\",\"autoShutdownNotificationStatus\":\"Enabled\",\"autoShutdownNotificationLocale\":\"en\",\"autoShutdownNotificationEmail\":\"vaibbavis@microsoft.com\",\"appGatewayName\":\"test-gateway\",\"appGateWayRuleName\":\"test-rule\",\"appGateWayRulePort\":80,\"appGateWayRuleProtocol\":\"Http\"}"
}