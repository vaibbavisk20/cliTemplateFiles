{
    "arm_template": "ARMTemplate: {\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"location\":{\"type\":\"string\"},\"networkInterfaceName1\":{\"type\":\"string\"},\"enableAcceleratedNetworking\":{\"type\":\"bool\"},\"networkSecurityGroupName\":{\"type\":\"string\"},\"networkSecurityGroupRules\":{\"type\":\"array\"},\"subnetName\":{\"type\":\"string\"},\"virtualNetworkId\":{\"type\":\"string\"},\"publicIpAddressName1\":{\"type\":\"string\"},\"publicIpAddressType\":{\"type\":\"string\"},\"publicIpAddressSku\":{\"type\":\"string\"},\"pipDeleteOption\":{\"type\":\"string\"},\"virtualMachineName\":{\"type\":\"string\"},\"virtualMachineName1\":{\"type\":\"string\"},\"virtualMachineComputerName1\":{\"type\":\"string\"},\"virtualMachineRG\":{\"type\":\"string\"},\"osDiskType\":{\"type\":\"string\"},\"osDiskDeleteOption\":{\"type\":\"string\"},\"virtualMachineSize\":{\"type\":\"string\"},\"nicDeleteOption\":{\"type\":\"string\"},\"hibernationEnabled\":{\"type\":\"bool\"},\"adminUsername\":{\"type\":\"string\"},\"patchMode\":{\"type\":\"string\"},\"rebootSetting\":{\"type\":\"string\"},\"virtualMachine1Zone\":{\"type\":\"string\"},\"autoShutdownStatus\":{\"type\":\"string\"},\"autoShutdownTime\":{\"type\":\"string\"},\"autoShutdownTimeZone\":{\"type\":\"string\"},\"autoShutdownNotificationStatus\":{\"type\":\"string\"},\"autoShutdownNotificationLocale\":{\"type\":\"string\"},\"autoShutdownNotificationEmail\":{\"type\":\"string\"},\"backupVaultName\":{\"type\":\"string\"},\"backupFabricName\":{\"type\":\"string\"},\"backupVaultRGName\":{\"type\":\"string\"},\"backupVaultRGIsNew\":{\"type\":\"bool\"},\"backupPolicyName\":{\"type\":\"string\"},\"backupPolicySchedule\":{\"type\":\"object\"},\"backupPolicyRetention\":{\"type\":\"object\"},\"backupPolicyTimeZone\":{\"type\":\"string\"},\"backupInstantRpRetentionRangeInDays\":{\"type\":\"int\"},\"backupInstantRPDetails\":{\"type\":\"object\"},\"backupItemName\":{\"type\":\"string\"},\"loadBalancerName\":{\"type\":\"string\"},\"loadbalancingRuleFrontEndPort\":{\"type\":\"int\"},\"loadbalancingRuleBackendEndPort\":{\"type\":\"int\"},\"loadbalancingRuleProtocol\":{\"type\":\"string\"}},\"variables\":{\"nsgId\":\"[resourceId(resourceGroup().name, 'Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroupName'))]\",\"vnetId\":\"[parameters('virtualNetworkId')]\",\"vnetName\":\"[last(split(variables('vnetId'), '/'))]\",\"subnetRef\":\"[concat(variables('vnetId'), '/subnets/', parameters('subnetName'))]\",\"aadLoginExtensionName\":\"AADSSHLoginForLinux\"},\"resources\":[{\"name\":\"[parameters('networkInterfaceName1')]\",\"type\":\"Microsoft.Network/networkInterfaces\",\"apiVersion\":\"2022-11-01\",\"location\":\"[parameters('location')]\",\"dependsOn\":[\"[concat('Microsoft.Network/networkSecurityGroups/', parameters('networkSecurityGroupName'))]\",\"[concat('Microsoft.Network/publicIpAddresses/', parameters('publicIpAddressName1'))]\",\"[concat('Microsoft.Network/loadBalancers/', parameters('loadBalancerName'))]\"],\"properties\":{\"ipConfigurations\":[{\"name\":\"ipconfig1\",\"properties\":{\"subnet\":{\"id\":\"[variables('subnetRef')]\"},\"privateIPAllocationMethod\":\"Dynamic\",\"publicIpAddress\":{\"id\":\"[resourceId(resourceGroup().name, 'Microsoft.Network/publicIpAddresses', parameters('publicIpAddressName1'))]\",\"properties\":{\"deleteOption\":\"[parameters('pipDeleteOption')]\"}},\"loadBalancerBackendAddressPools\":[{\"id\":\"[resourceId('Microsoft.Network/loadBalancers/backendAddressPools', parameters('loadBalancerName'), concat(take(parameters('loadBalancerName'), sub(80, length('-backendpool01'))), '-backendpool01'))]\"}]}}],\"enableAcceleratedNetworking\":\"[parameters('enableAcceleratedNetworking')]\",\"networkSecurityGroup\":{\"id\":\"[variables('nsgId')]\"}}},{\"name\":\"[parameters('networkSecurityGroupName')]\",\"type\":\"Microsoft.Network/networkSecurityGroups\",\"apiVersion\":\"2020-05-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"securityRules\":\"[parameters('networkSecurityGroupRules')]\"}},{\"name\":\"[parameters('publicIpAddressName1')]\",\"type\":\"Microsoft.Network/publicIpAddresses\",\"apiVersion\":\"2020-08-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publicIpAllocationMethod\":\"[parameters('publicIpAddressType')]\"},\"sku\":{\"name\":\"[parameters('publicIpAddressSku')]\"},\"zones\":[\"[parameters('virtualMachine1Zone')]\"]},{\"name\":\"[parameters('virtualMachineName1')]\",\"type\":\"Microsoft.Compute/virtualMachines\",\"apiVersion\":\"2024-03-01\",\"location\":\"[parameters('location')]\",\"dependsOn\":[\"[concat('Microsoft.Network/networkInterfaces/', parameters('networkInterfaceName1'))]\"],\"properties\":{\"hardwareProfile\":{\"vmSize\":\"[parameters('virtualMachineSize')]\"},\"storageProfile\":{\"osDisk\":{\"createOption\":\"fromImage\",\"managedDisk\":{\"storageAccountType\":\"[parameters('osDiskType')]\"},\"deleteOption\":\"[parameters('osDiskDeleteOption')]\"},\"imageReference\":{\"publisher\":\"canonical\",\"offer\":\"0001-com-ubuntu-server-focal\",\"sku\":\"20_04-lts-gen2\",\"version\":\"latest\"}},\"networkProfile\":{\"networkInterfaces\":[{\"id\":\"[resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfaceName1'))]\",\"properties\":{\"deleteOption\":\"[parameters('nicDeleteOption')]\"}}]},\"additionalCapabilities\":{\"hibernationEnabled\":false},\"osProfile\":{\"computerName\":\"[parameters('virtualMachineComputerName1')]\",\"adminUsername\":\"[parameters('adminUsername')]\",\"linuxConfiguration\":{\"disablePasswordAuthentication\":true,\"patchSettings\":{\"patchMode\":\"[parameters('patchMode')]\",\"automaticByPlatformSettings\":{\"rebootSetting\":\"[parameters('rebootSetting')]\"}}}},\"diagnosticsProfile\":{\"bootDiagnostics\":{\"enabled\":true}}},\"identity\":{\"type\":\"systemAssigned\"},\"zones\":[\"[parameters('virtualMachine1Zone')]\"]},{\"name\":\"[concat('shutdown-computevm-', parameters('virtualMachineName1'))]\",\"type\":\"Microsoft.DevTestLab/schedules\",\"apiVersion\":\"2018-09-15\",\"location\":\"[parameters('location')]\",\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/', parameters('virtualMachineName1'))]\"],\"properties\":{\"status\":\"[parameters('autoShutdownStatus')]\",\"taskType\":\"ComputeVmShutdownTask\",\"dailyRecurrence\":{\"time\":\"[parameters('autoShutdownTime')]\"},\"timeZoneId\":\"[parameters('autoShutdownTimeZone')]\",\"targetResourceId\":\"[resourceId('Microsoft.Compute/virtualMachines', parameters('virtualMachineName1'))]\",\"notificationSettings\":{\"status\":\"[parameters('autoShutdownNotificationStatus')]\",\"notificationLocale\":\"[parameters('autoShutdownNotificationLocale')]\",\"timeInMinutes\":\"30\",\"emailRecipient\":\"[parameters('autoShutdownNotificationEmail')]\"}}},{\"apiVersion\":\"2017-05-10\",\"name\":\"BackupVaultAndOrPolicy-defaultVault974-EnhancedPolicy-lvy6m16j\",\"type\":\"Microsoft.Resources/deployments\",\"resourceGroup\":\"[parameters('backupVaultRGName')]\",\"properties\":{\"mode\":\"Incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"resources\":[{\"name\":\"[parameters('backupVaultName')]\",\"type\":\"Microsoft.RecoveryServices/vaults\",\"apiVersion\":\"2016-06-01\",\"location\":\"[parameters('location')]\",\"sku\":{\"name\":\"RS0\",\"tier\":\"Standard\"},\"properties\":{},\"dependsOn\":[]},{\"name\":\"[concat(parameters('backupVaultName'), '/', parameters('backupPolicyName'))]\",\"apiVersion\":\"2017-07-01\",\"type\":\"Microsoft.RecoveryServices/vaults/backupPolicies\",\"properties\":{\"backupManagementType\":\"AzureIaasVM\",\"policyType\":\"V2\",\"schedulePolicy\":\"[parameters('backupPolicySchedule')]\",\"retentionPolicy\":\"[parameters('backupPolicyRetention')]\",\"timeZone\":\"[parameters('backupPolicyTimeZone')]\",\"instantRpRetentionRangeInDays\":\"[parameters('backupInstantRpRetentionRangeInDays')]\",\"instantRPDetails\":\"[parameters('backupInstantRPDetails')]\"},\"dependsOn\":[\"[resourceId(parameters('backupVaultRGName'), 'Microsoft.RecoveryServices/vaults', parameters('backupVaultName'))]\"]}]}}},{\"apiVersion\":\"2017-05-10\",\"name\":\"[concat(parameters('virtualMachineName1'), '-' , 'BackupIntent')]\",\"type\":\"Microsoft.Resources/deployments\",\"resourceGroup\":\"[parameters('backupVaultRGName')]\",\"properties\":{\"mode\":\"Incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"resources\":[{\"name\":\"[concat(parameters('backupVaultName'), '/', parameters('backupFabricName'), '/', parameters('backupItemName'))]\",\"apiVersion\":\"2017-07-01\",\"type\":\"Microsoft.RecoveryServices/vaults/backupFabrics/backupProtectionIntent\",\"properties\":{\"friendlyName\":\"[concat(parameters('virtualMachineName'), 'BackupIntent')]\",\"protectionIntentItemType\":\"AzureResourceItem\",\"policyId\":\"[resourceId(parameters('backupVaultRGName'), 'Microsoft.RecoveryServices/vaults/backupPolicies', parameters('backupVaultName'), parameters('backupPolicyName'))]\",\"sourceResourceId\":\"[resourceId(parameters('virtualMachineRG'), 'Microsoft.Compute/virtualMachines', parameters('virtualMachineName'))]\"}}]}},\"dependsOn\":[\"[resourceId(parameters('virtualMachineRG'), 'Microsoft.Compute/virtualMachines', parameters('virtualMachineName1'))]\",\"[concat('Microsoft.Resources/deployments', '/', 'BackupVaultAndOrPolicy-defaultVault974-EnhancedPolicy-lvy6m16j')]\"]},{\"name\":\"[concat(parameters('loadBalancerName'), '-publicip')]\",\"type\":\"Microsoft.Network/publicIpAddresses\",\"apiVersion\":\"2020-08-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publicIpAllocationMethod\":\"Static\",\"publicIPAddressVersion\":\"IPv4\",\"idleTimeoutInMinutes\":15},\"sku\":{\"name\":\"Standard\"},\"zones\":[\"1\"]},{\"name\":\"[parameters('loadBalancerName')]\",\"type\":\"Microsoft.Network/loadBalancers\",\"apiVersion\":\"2021-05-01\",\"location\":\"[parameters('location')]\",\"sku\":{\"name\":\"Standard\"},\"properties\":{\"frontendIPConfigurations\":[{\"name\":\"[concat(take(parameters('loadBalancerName'), sub(80, length('-frontendconfig01'))), '-frontendconfig01')]\",\"properties\":{\"publicIPAddress\":{\"id\":\"[resourceId('Microsoft.Network/publicIpAddresses', concat(parameters('loadBalancerName'), '-publicip'))]\"}}}],\"backendAddressPools\":[{\"name\":\"[concat(take(parameters('loadBalancerName'), sub(80, length('-backendpool01'))), '-backendpool01')]\"}],\"loadBalancingRules\":[{\"name\":\"[concat(parameters('loadBalancerName'), '-lbrule01')]\",\"properties\":{\"frontendIPConfiguration\":{\"id\":\"[resourceId('Microsoft.Network/loadBalancers/frontendIPConfigurations', parameters('loadBalancerName'), concat(take(parameters('loadBalancerName'), sub(80, length('-frontendconfig01'))), '-frontendconfig01'))]\"},\"backendAddressPool\":{\"id\":\"[resourceId('Microsoft.Network/loadBalancers/backendAddressPools', parameters('loadBalancerName'), concat(take(parameters('loadBalancerName'), sub(80, length('-backendpool01'))), '-backendpool01'))]\"},\"frontendPort\":\"[parameters('loadbalancingRuleFrontEndPort')]\",\"backendPort\":\"[parameters('loadbalancingRuleBackendEndPort')]\",\"enableFloatingIP\":false,\"idleTimeoutInMinutes\":15,\"disableOutboundSnat\":true,\"loadDistribution\":\"Default\",\"protocol\":\"[parameters('loadbalancingRuleProtocol')]\",\"probe\":{\"id\":\"[resourceId('Microsoft.Network/loadBalancers/probes', parameters('loadBalancerName'), concat(parameters('loadBalancerName'), '-probe01'))]\"}}}],\"probes\":[{\"name\":\"[concat(parameters('loadBalancerName'), '-probe01')]\",\"properties\":{\"intervalInSeconds\":15,\"numberOfProbes\":2,\"requestPath\":\"[if(equals(parameters('loadbalancingRuleProtocol'),'Tcp'), json('null'), '/')]\",\"port\":\"[if(equals(parameters('loadbalancingRuleProtocol'), 'Tcp'), parameters('loadbalancingRuleBackendEndPort'), '80')]\",\"protocol\":\"[if(equals(parameters('loadbalancingRuleProtocol'),'Tcp'), 'Tcp', 'Http')]\"}}]},\"dependsOn\":[\"[concat('Microsoft.Network/publicIpAddresses/', concat(parameters('loadBalancerName'), '-publicip'))]\"]},{\"name\":\"[concat(parameters('virtualMachineName1'),'/', variables('aadLoginExtensionName'))]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"apiVersion\":\"2018-10-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.Azure.ActiveDirectory\",\"type\":\"[variables('aadLoginExtensionName')]\",\"typeHandlerVersion\":\"1.0\",\"autoUpgradeMinorVersion\":true},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/', parameters('virtualMachineName1'))]\"]}],\"outputs\":{\"adminUsername\":{\"type\":\"string\",\"value\":\"[parameters('adminUsername')]\"}}}, TemplateParameters: {\"location\":\"eastus\",\"networkInterfaceName1\":\"vm-2855_z1\",\"enableAcceleratedNetworking\":true,\"networkSecurityGroupName\":\"vm-2-nsg\",\"networkSecurityGroupRules\":[{\"name\":\"default-allow-ssh\",\"properties\":{\"priority\":1000,\"protocol\":\"TCP\",\"access\":\"Allow\",\"direction\":\"Inbound\",\"sourceApplicationSecurityGroups\":[],\"destinationApplicationSecurityGroups\":[],\"sourceAddressPrefix\":\"*\",\"sourcePortRange\":\"*\",\"destinationAddressPrefix\":\"*\",\"destinationPortRange\":\"22\"}},{\"name\":\"test-lb-allow-inbound\",\"properties\":{\"priority\":999,\"protocol\":\"*\",\"access\":\"Allow\",\"direction\":\"Inbound\",\"sourceApplicationSecurityGroups\":[],\"destinationApplicationSecurityGroups\":[],\"sourceAddressPrefix\":\"*\",\"sourcePortRange\":\"*\",\"destinationAddressPrefix\":\"*\",\"destinationPortRange\":\"80\"}}],\"subnetName\":\"default\",\"virtualNetworkId\":\"/subscriptions/443b0799-279f-401e-a220-aa1463a7710f/resourceGroups/vsk-demo-rg/providers/Microsoft.Network/virtualNetworks/new-vnet\",\"publicIpAddressName1\":\"vm-2-ip\",\"publicIpAddressType\":\"Static\",\"publicIpAddressSku\":\"Standard\",\"pipDeleteOption\":\"Detach\",\"virtualMachineName\":\"vm-2\",\"virtualMachineName1\":\"vm-2\",\"virtualMachineComputerName1\":\"vm-2\",\"virtualMachineRG\":\"vsk-demo-rg\",\"osDiskType\":\"Premium_LRS\",\"osDiskDeleteOption\":\"Delete\",\"virtualMachineSize\":\"Standard_D2lds_v5\",\"nicDeleteOption\":\"Detach\",\"hibernationEnabled\":false,\"adminUsername\":\"azureuser\",\"patchMode\":\"AutomaticByPlatform\",\"rebootSetting\":\"IfRequired\",\"virtualMachine1Zone\":\"1\",\"autoShutdownStatus\":\"Enabled\",\"autoShutdownTime\":\"19:00\",\"autoShutdownTimeZone\":\"UTC\",\"autoShutdownNotificationStatus\":\"Enabled\",\"autoShutdownNotificationLocale\":\"en\",\"autoShutdownNotificationEmail\":\"vaibbavis@microsoft.com\",\"backupVaultName\":\"defaultVault974\",\"backupFabricName\":\"Azure\",\"backupVaultRGName\":\"vsk-demo-rg\",\"backupVaultRGIsNew\":false,\"backupPolicyName\":\"EnhancedPolicy-lvy6m16j\",\"backupPolicySchedule\":{\"schedulePolicyType\":\"SimpleSchedulePolicyV2\",\"scheduleRunFrequency\":\"Hourly\",\"hourlySchedule\":{\"interval\":4,\"scheduleWindowStartTime\":\"2021-07-26T08:00:00Z\",\"scheduleWindowDuration\":12}},\"backupPolicyRetention\":{\"retentionPolicyType\":\"LongTermRetentionPolicy\",\"dailySchedule\":{\"retentionTimes\":[\"2024-05-09T06:00:00.000Z\"],\"retentionDuration\":{\"count\":30,\"durationType\":\"Days\"}},\"weeklySchedule\":null,\"monthlySchedule\":null,\"yearlySchedule\":null},\"backupPolicyTimeZone\":\"UTC\",\"backupInstantRpRetentionRangeInDays\":7,\"backupInstantRPDetails\":{\"azureBackupRGNamePrefix\":\"\",\"azureBackupRGNameSuffix\":\"\"},\"backupItemName\":\"vm;iaasvmcontainerv2;vsk-demo-rg;vm-2\",\"loadBalancerName\":\"test-lb\",\"loadbalancingRuleFrontEndPort\":80,\"loadbalancingRuleBackendEndPort\":80,\"loadbalancingRuleProtocol\":\"Tcp\"}"
}